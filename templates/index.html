{% extends "base.html" %}
{% block title %}首页 - 考研院校推荐系统{% endblock %}

{% block head_extra %}
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h1 class="mb-4 text-center">可视化数据面板</h1>

    <div class="dashboard-grid">
        <!-- 第一列：国家线图表 -->
        <div id="national-line-total" class="chart-container"></div>
        <div id="national-line-politics" class="chart-container"></div>
        <div id="national-line-others" class="chart-container"></div>

        <!-- 第二列：院校滚动列表 (改为表格+分页) -->
         <div id="school-list-container" class="dashboard-schools-list"> {# 保持 ID 和 Class #}
             <h4 class="text-center p-3 mb-0 border-bottom border-secondary">院校速览</h4>
             <div class="dashboard-schools-table-container"> {# 用于滚动的容器 #}
                 <table class="table table-sm table-hover dashboard-schools-table align-middle">
                     <thead>
                         <tr>
                             <th>院校名称</th>
                             <th>等级</th>
                             <th>省份</th>
                             <th>计算机等级</th>
                             {# <th>招生人数</th>
                             <th>考试科目</th> #}
                         </tr>
                     </thead>
                     <tbody id="dashboard-school-table-body">
                         <!-- JS 动态填充 -->
                         <tr><td colspan="4" class="text-center p-5"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">加载中...</span></div> 正在加载院校数据...</td></tr>
                     </tbody>
                 </table>
             </div>
             <div id="dashboard-school-pagination" class="p-2 border-top border-secondary d-flex justify-content-center"></div>
         </div>

        <!-- 第三列：饼图和公告 -->
        <div id="exam-type-pie" class="chart-container"></div>
        <div id="announcements">
             <h4 class="text-center p-3 mb-0 border-bottom border-secondary">最新公告</h4>
            <ul id="announcement-list" class="list-group list-group-flush p-2">
                <li class="list-group-item bg-transparent text-center p-5"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">加载中...</span></div> 正在加载公告...</li>
            </ul>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        initCharts(); // 初始化所有图表
        fetchSchoolsForDashboard(); // 加载仪表盘院校列表（包含分页）
        fetchAnnouncements(); // 加载公告
    });
</script>
{% endblock %} 